# Log Viewer

Это веб-приложение для просмотра логов Docker-контейнеров, запущенных на инстансах Google Cloud Engine (GCE). Приложение позволяет выбирать узел (GCE инстанс), контейнер и просматривать его логи в удобном интерфейсе с поддержкой ANSI-цветов и пагинации.

## Функциональность

- **Выбор узла**: Выберите один из предопределенных GCE инстансов (neuroboss-service-prod, rag-service-prod, agent-service-prod).
- **Выбор контейнера**: После выбора узла отображаются доступные Docker-контейнеры на этом инстансе.
- **Просмотр логов**: Логи загружаются и отображаются с поддержкой цветового кодирования (ANSI escape sequences).
- **Пагинация**: Логи загружаются постранично для улучшения производительности. Используйте клавишу `Space` для загрузки следующих строк.
- **API**: RESTful API на базе FastAPI для получения списка узлов, контейнеров и логов.

## Архитектура

- **Backend**: Python с FastAPI. Использует `gcloud` для SSH-доступа к GCE инстансам и получения логов Docker.
- **Frontend**: Простая HTML-страница с JavaScript для взаимодействия с API.
- **Развертывание**: Ansible playbook для автоматического развертывания на сервере.

## Требования

- Python 3.7+
- Установленный `gcloud` CLI с настроенной аутентификацией для доступа к GCE.
- Доступ к указанным GCE инстансам по SSH.

## Установка и запуск

### Локальный запуск

1. Клонируйте репозиторий:
   ```
   git clone https://github.com/psych0panda/log_viewer.git
   cd log_viewer
   ```

2. Установите зависимости:
   ```
   cd backend
   pip install -r requirements.txt
   ```

3. Запустите сервер:
   ```
   python main.py
   ```
   Сервер будет доступен на `http://localhost:27015`.

4. Откройте браузер и перейдите по адресу `http://localhost:27015` для доступа к интерфейсу.

### Развертывание с помощью Ansible

Ansible playbook `ansible/configure_docker_logging.yml` позволяет развернуть приложение на удаленном сервере.

1. Настройте переменные в playbook (например, `repo_url` на ваш репозиторий).

2. Запустите playbook:
   ```
   ansible-playbook ansible/configure_docker_logging.yml -i <inventory-file>
   ```

Playbook установит зависимости, клонирует репозиторий, создаст systemd сервис и запустит приложение.

## API Endpoints

- `GET /`: Возвращает главную страницу (frontend/index.html).
- `GET /api/nodes`: Возвращает список доступных узлов (GCE инстансов).
- `GET /api/containers?node=<node>`: Возвращает список контейнеров на указанном узле.
- `GET /api/logs?node=<node>&container=<container>`: Возвращает логи указанного контейнера в виде потока.

## Конфигурация

- Список GCE инстансов и зона определены в `backend/main.py`:
  ```python
  GCE_INSTANCE_NAMES = ['neuroboss-service-prod', 'rag-service-prod', 'agent-service-prod']
  GCE_ZONE = 'us-central1-a'
  ```

Измените эти значения по необходимости.

## Безопасность

- В продакшене настройте CORS origins в FastAPI middleware.
- Убедитесь, что `gcloud` аутентифицирован и имеет необходимые разрешения для доступа к GCE инстансам.

## Лицензия

Укажите лицензию проекта, если применимо.
